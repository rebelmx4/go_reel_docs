### 1. 痛点与动机

- 
- **痛点**：
  - 
  - 用户在浏览视频时，经常遇到质量差或不感兴趣的视频，需要快速清理。
  - 直接物理删除（Shift+Delete）风险太大，万一删错了无法找回。
  - 有些视频用户投入了时间（截图、点赞、打标签），误删会导致用户付出的劳动（元数据）丢失。
- **动机**：
  - 
  - 提供一个“回收站”式的缓冲机制，将文件移动而非直接删除。
  - **智能防误删**：对于包含高价值元数据（如已收藏、有点赞）的视频，增加确认门槛，防止“手滑”导致重要数据流失。
  - **扫描隔离**：确保软件不会反复扫描这些已经被用户标记为“不要”或“已看完”的文件。

### 2. 功能概要

- 
- **快捷操作**：在视频播放过程中，按下 Ctrl + Delete 触发。
- **软删除**：文件不会被物理销毁，而是被**移动**到 setting.json 中配置的 pending_delete_path 目录。
- **保护机制**：针对“高价值”视频触发弹窗确认。
- **播放衔接**：执行删除操作后，播放器不应停止，而应自动播放列表中的下一个视频。

### 3. 智能保护与确认逻辑

为了防止误删重要内容，系统在执行移动操作前会进行**预检查**。

#### 3.1 触发条件

当用户按下 Ctrl + Delete 时，系统检查以下四个维度：

1. 
2. **点赞 (Likes)**：like_count > 0。
3. **精品/收藏 (Favorites)**：is_favorite == true。
4. **标签 (Tags)**：tags 列表不为空。
5. **手动截图 (Manual Screenshots)**：检测该视频是否有用户手动保存的截图（或已设置过手动封面）。

#### 3.2 交互流程

- 
- **情况 A：无任何高价值标记**
  - 
  - **行为**：**静默执行**。
  - **结果**：视频文件立即移动到待删除目录，播放器自动切到下一集。
- **情况 B：存在一项或多项标记**
  - 
  - **行为**：**中断操作，弹出确认框**。
  - **弹窗内容**：
    - 
    - 标题：“确认删除？”
    - **核心提示（动态生成）**：“该视频包含以下重要信息，删除将导致这些数据失效：”
      - 
      - *[ ] 包含 5 个点赞*
      - *[ ] 已被标记为精品*
      - *[ ] 包含 '风景' 等 3 个标签*
      - *[ ] 包含手动截图*
    - 按钮：“确认移动” / “取消”。
  - **结果**：只有用户点击“确认移动”后，才执行移动操作。

### 4. 目录扫描与排除逻辑

为了保证软件性能和列表的纯净度，软件在读取文件时需执行**黑名单排除**策略。

- 
- **配置项**：
  - 
  - setting.json 中配置的 pending_delete_path（待删除目录）。
  - setting.json 中配置的 processed_path（已处理/已编辑目录）。
- **场景**：
  - 
  - **软件冷启动**（Initial Scan）。
  - **F5 刷新**（Rescan）。
- **逻辑**：
  - 
  - 扫描器遍历视频根目录时，必须检测当前遍历的文件夹路径。
  - **判定**：如果当前路径 **等于** 或 **属于** pending_delete_path 或 processed_path 的子目录。
  - **动作**：**跳过（Skip）**。不读取其中的视频文件，不计算哈希，不加入播放列表。
- **目的**：
  - 
  - 防止已删除的视频“诈尸”回到随机列表中。
  - 防止剪辑好的成品（已处理）干扰原材料的浏览。

### 5. Setting 配置与数据处理

- 
- **setting.json**：
  - 
  - pending_delete_path: 字符串，绝对路径。
  - processed_path: 字符串，绝对路径。
- **元数据处理**：
  - 
  - 当视频被成功移动到待删除目录后：
    - 
    - **内存更新**：从当前所有活动的播放列表（随机、最新、最近等）中移除该视频对象。
    - **数据清理**：虽然文件还在磁盘（待删除目录），但建议在 files.json 中标记其状态或直接移除其条目，以免造成数据冗余。

### 6. 总结流程图

codeMermaid



```
graph TD
    A[用户按 Ctrl+Delete] --> B{检查高价值属性}
    B -- 无属性 --> C[执行移动文件]
    B -- 有属性(点赞/收藏/截图/标签) --> D[弹出确认框]
    D -- 显示具体原因 --> E{用户确认?}
    E -- 是 --> C
    E -- 否 --> F[取消操作]
    C --> G[更新内存列表]
    G --> H[播放下一个视频]
    
    I[软件启动 / F5刷新] --> J[遍历目录]
    J --> K{是待删除或已处理目录?}
    K -- 是 --> L[跳过不读取]
    K -- 否 --> M[读取视频并入库]
```