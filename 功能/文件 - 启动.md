### 1. 核心目标与设计哲学

- 
- **极速启动**：启动时不进行耗时的哈希计算或全盘元数据校验，仅读取最基本的文件属性（路径 + 创建时间）。
- **即刻可用**：数据加载足以支撑“随机播放”和“最新视频”这两个最常用的功能，让用户点击图标后立即开始观看。
- **强制配置**：确保软件运行所需的关键目录已配置，否则阻断进入主界面。

### 2. 启动流程详解

启动过程分为 **配置检查**、**轻量扫描**、**数据装载** 和 **现场恢复** 四个阶段。

#### 第一阶段：配置完整性检查 (Configuration Check)

1. 
2. **读取配置**：加载 data/setting.json。
3. **路径校验**：检查以下关键路径字段是否为空：
   - 
   - 视频源目录 (Scan Paths)
   - 待删除目录 (pending_delete_path)
   - 已处理/已编辑目录 (processed_path)
   - 截图导出目录 (screenshot_export_path)
4. **分支决策**：
   - 
   - **若有任意路径为空**：不进入主界面，直接跳转到 **路径设置页面**，强制用户完成配置。
   - **若路径均有效**：进入第二阶段。

#### 第二阶段：轻量级文件扫描 (Lightweight Scanning)

此阶段的目标是建立文件索引，但 **排除** “垃圾桶”和“成品库”。

1. 
2. **遍历目录**：扫描视频源目录下的所有文件。
3. **黑名单过滤**：
   - 
   - 检查当前遍历的文件夹路径。
   - **跳过**：如果路径属于 pending_delete_path（待删除）或 processed_path（已处理）。这确保了已看完或已废弃的视频不会出现在播放列表中。
4. **采集属性**：仅获取两个字段：
   - 
   - File Path（文件路径）
   - Creation Time（创建时间）
5. **结果**：在内存中构建一个基础的 VideoList。

#### 第三阶段：元数据与列表构建 (Data Loading & List Building)

虽然不计算哈希，但需预加载元数据文件以备匹配（通常基于路径或在播放时基于哈希匹配）。

1. 
2. **加载数据文件**：
   - 
   - 读取 data/files.json（元数据：标签、评分、旋转角度、Hash等）。
   - 读取 data/Recent.json（最近播放记录）。
   - 读取 data/setting.json 中的 skip_frame 配置。
3. **构建核心播放列表**：
   - 
   - **随机列表 (默认)**：基于扫描到的所有文件。
   - **最新列表**：对扫描结果按 Creation Time 倒序排序，截取前 100 个。
   - **最近列表**：解析 Recent.json，并移除其中在扫描结果中不存在的无效条目。
   - **其他列表 (精品/点赞)**：基于 files.json 中的标记（is_favorite, like_count）预筛选。

#### 第四阶段：状态恢复与 UI 呈现 (State Restoration & UI)

1. 
2. **播放模式重置**：
   - 
   - **列表模式**：强制重置为 **随机播放模式**（Random Play）。
   - **跳帧模式**：读取 setting.json 中的记录，恢复上一次的“正常播放”或“跳帧播放”状态。
3. **音量恢复**：读取 global_volume 并应用。
4. **UI 渲染**：
   - 
   - 显示主窗口。
   - 标题栏显示当前随机到的视频信息（进度、文件名、时长）。
   - **视口自适应**：根据视频分辨率调整视口大小（720p 策略）。
5. **准备就绪**：
   - 
   - 加载随机列表中的第一个视频，等待用户操作（或自动播放，视具体配置而定）。

### 3. 数据流向图

codeMermaid



```mermaid
graph TD
    Start[软件启动] --> ConfigCheck{检查 setting.json 路径}
    
    ConfigCheck -- 路径为空 --> SetupPage[进入路径设置页面]
    SetupPage --> End1[配置完成重启或进入]
    
    ConfigCheck -- 路径正常 --> Scan[遍历视频目录]
    
    Scan --> Filter{检查目录黑名单}
    Filter -- 是待删除/已处理 --> Skip[跳过不读取]
    Filter -- 是普通目录 --> ReadInfo[读取路径 + 创建时间]
    
    ReadInfo --> LoadData[加载 files.json & Recent.json]
    
    LoadData --> BuildLists[构建内部列表]
    subgraph 列表构建
    B1[随机列表 (Base)]
    B2[最新列表 (Top 100 Time)]
    B3[最近/精品/点赞列表]
    end
    
    BuildLists --> RestoreState[恢复状态]
    subgraph 状态恢复
    S1[强制设为随机模式]
    S2[恢复跳帧/正常模式]
    S3[恢复全局音量]
    end
    
    RestoreState --> ShowUI[显示主界面]
```

### 4. 关键点总结













| 环节         | 关键行为                             | 目的                             |
| ------------ | ------------------------------------ | -------------------------------- |
| **IO 策略**  | **不**计算 Hash，只读时间/路径       | 保证启动速度，毫秒级响应。       |
| **黑名单**   | 自动跳过 pending_delete 和 processed | 列表纯净，防止已删除视频“诈尸”。 |
| **初始模式** | 锁定为 **随机播放**                  | 解决“不知道看什么”的选择困难症。 |
| **异常处理** | 路径为空则拦截                       | 防止软件在未配置状态下运行报错。 |