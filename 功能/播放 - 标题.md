### 1. 痛点与动机

- 
- **痛点**：
  - 
  - 在播放长列表（如“最新100”或“点赞列表”）时，用户无法感知当前播放到了第几个，缺乏全局进度感。
  - 文件名过长时，往往挤占了时长信息的显示空间，或者直接导致界面排版混乱。
- **动机**：
  - 
  - 增加 **[当前/总数]** 的计数器，让用户对当前播放位置一目了然。
  - 采用**动态弹性布局**算法，在有限的标题栏空间内，优先展示关键信息（进度、时长），智能截断次要信息（文件名的中间或末尾）。

### 2. 功能概要

- 
- **组合信息展示**：标题栏中央区域依次显示：[列表进度] + 文件名 + (时长)。
- **上下文感知**：进度计数器 [n/m] 会根据当前激活的播放列表（随机、最新、点赞等）动态变化。
- **自适应排版**：根据窗口大小动态计算文本区域宽度，自动隐藏文件名的多余部分。

### 3. 显示格式与逻辑

#### 3.1 文本格式

标准格式为： **[n/m]Filename (Duration)**

- 
- **[n/m]**：
  - 
  - **n (Index)**：当前视频在当前列表中的序号（从 1 开始）。
  - **m (Total)**：当前播放列表的总视频数。
  - *示例*：[15/100] 表示正在播放列表中的第 15 个视频，共 100 个。
- **Filename**：
  - 
  - 视频的文件名（通常包含扩展名，也可配置隐藏）。
- **(Duration)**：
  - 
  - 视频的总时长，格式化为 MM:SS 或 HH:MM:SS。

#### 3.2 数据源（上下文联动）

标题栏的数据必须与播放器的**当前播放列表状态**强绑定：

- 
- **随机播放模式**：m = 数据库中所有视频的总数。
- **点赞列表模式**：m = 点赞列表的总数（即所有分段内的视频总和）。
- **最新列表模式**：m = 100。
- **最近播放模式**：m = 50。
- **文件名搜索模式**：m = 搜索结果的总条数。
- **精品列表模式**：m = 收藏视频的总数。

### 4. UI 布局与动态截断

#### 4.1 区域计算

文本显示区域的可用宽度 (

```
WtextWtext
```

) 计算公式：



```
Wtext=WWindow−WLeftTabs−WRightControls−PaddingWtext=WWindow−WLeftTabs−WRightControls−Padding
```



- 

- 

  ```
  WWindowWWindow
  ```

  ：软件窗口总宽度。

  

- 

  ```
  WLeftTabsWLeftTabs
  ```

  ：左侧页签按钮组的总宽度。

  

- 

  ```
  WRightControlsWRightControls
  ```

  ：右侧窗口控制按钮（最小化、最大化、关闭）的总宽度。

  

#### 4.2 渲染优先级与截断策略

当 

```
WtextWtext
```

 不足以显示所有内容时，遵循以下优先级：



1. 
2. **最高优先级（必须显示）**：[n/m] 和 (Duration)。这两部分信息短且关键，不应被截断。
3. **次优先级（可被截断）**：Filename。
   - 
   - 如果空间不足，计算剩余空间给文件名。
   - **截断方式**：建议使用**中间省略**（Ellipsis in the middle）或**末尾省略**。
   - *示例*：[15/100] MyLongVideoName...h264.mp4 (10:23) 或 [15/100] MyLongVideo... (10:23)。

### 5. 总结











| 显示元素   | 数据来源                 | 优先级        | 动态行为                   |
| ---------- | ------------------------ | ------------- | -------------------------- |
| **进度**   | 当前列表的 Index / Total | **高** (保留) | 随切歌、切列表模式实时更新 |
| **文件名** | file_path                | 低 (截断)     | 随窗口缩放动态计算可见长度 |
| **时长**   | 视频元数据               | **高** (保留) | 固定格式显示               |