### 1. 痛点与动机

- 
- **痛点**：
  - 
  - 有些精彩瞬间是动态的（如一段搞笑对话、一个动作连招），静态截图无法完整表达神韵。
  - 使用外部录屏软件步骤繁琐，且很难精确卡点录制当前视频的特定片段。
- **动机**：
  - 
  - 提供**“所见即所得”**的流式录制能力。
  - 将短视频片段视为“动态截图”，与静态截图纳入统一的管理和导出体系，方便素材收集。

### 2. 功能概要

- 
- **即时录制**：从当前播放帧开始录制，再次点击按钮停止。
- **UI 反馈**：视口右上角实时显示录制时长。
- **统一存储**：录制的视频文件与截图文件存储在同一目录下。
- **联动导出**：使用截图导出功能（Alt+E）时，录制的视频片段也会被一并导出。

### 3. 数据存储与命名规范

- 
- **存储路径**：Data/screenshot/[Video_Hash]/。
  - 
  - 与静态截图（i_xxx.webp）完全共用同一个文件夹。
- **文件命名逻辑**：v_[毫秒时间戳].mp4。
  - 
  - *示例*：v_1716889200000.mp4。
  - **前缀 v_**：用于区分这是一个 Video 片段，区别于图片的 i_。
  - **时间戳**：建议使用**开始录制时**的系统时间戳，确保唯一性。

### 4. UI 布局与交互

#### 4.1 控制按钮

- 
- **位置**：位于 **截图按钮**（Screenshot Icon）的旁边，归属于“素材提取”功能组。
- **样式**：
  - 
  - **默认状态**：圆形的录制图标（🔴）。
  - **录制中状态**：方形的停止图标（⏹），且可能带有红色闪烁效果。
- **交互**：
  - 
  - **点击开始**：视频继续播放，后台开始捕获流。
  - **点击停止**：结束录制，保存文件，按钮恢复默认状态。

#### 4.2 视口反馈 (OSD)

- 
- **位置**：视频播放视口（Viewport）的 **右上角**。
- **显示内容**：
  - 
  - **红点指示器** + **录制时长**。
  - *格式*：🔴 REC 00:00:12。
- **逻辑**：仅在录制状态下显示，录制结束后立即消失。

### 5. 导出逻辑联动

录制功能并不是孤立的，它深度集成了现有的 **截图导出体系**：

- 
- **触发方式**：用户按下 Alt + E（或点击导出截图按钮）。
- **包含内容**：
  - 
  - 系统在打包 Data/screenshot/[Video_Hash]/ 目录下的内容时，不再仅限于 .webp 图片。
  - **新增规则**：扫描并包含所有 v_*.mp4 文件。
- **旋转处理**：
  - 
  - 如果用户在导出弹窗中设置了旋转（如 90度），录制的视频片段在导出时**建议**也进行相应的旋转处理（Re-encode with rotation metadata），或者至少原样导出。
  - *建议逻辑*：为保证导出速度，默认原样复制文件；若技术允许，可根据 screenshot_rotation 元数据为 MP4 写入旋转标记。

### 6. 核心逻辑细节

- 
- **录制范围**：
  - 
  - **开始**：点击按钮的瞬间（当前帧）。
  - **结束**：再次点击按钮的瞬间。
- **暂停处理**：
  - 
  - 如果在录制过程中用户按下了暂停（Space）：录制计时器也应**暂停**。
  - 当恢复播放时：录制继续。
  - 最终生成的文件应是**连续的**，不包含暂停期间的静止画面。
- **步进录制**：
  - 
  - 允许用户在“录制中”使用步进功能（A/D键）。这将允许用户以极慢的速度、逐帧地录制精细操作，最终生成的 MP4 仍按正常帧率播放（即实现了类似“逐帧动画”或慢动作捕捉的效果）。

### 7. 总结





| 特性        | 录制功能 (Recording)    | 截图功能 (Screenshot)   |
| ----------- | ----------------------- | ----------------------- |
| **产物**    | .mp4 视频片段           | .webp 静态图片          |
| **命名**    | v_[时间戳]              | i_[时间戳]              |
| **存储**    | Data/screenshot/[Hash]/ | Data/screenshot/[Hash]/ |
| **导出**    | 随 Alt+E 一并导出       | 随 Alt+E 一并导出       |
| **UI 反馈** | 按钮变方 + 右上角计时器 | 顶部 Toast 提示         |