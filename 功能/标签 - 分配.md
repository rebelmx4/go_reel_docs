### 1. 核心目标

该页面是用户管理**当前视频**与**标签库**关系的枢纽。

- 
- **主要任务**：将已存在的标签“贴”到当前视频上，或将已贴的标签“撕”下来。
- **次要任务**：当搜索不到现有标签时，作为进入“标签创建流程”的快速入口。

### 2. UI 布局结构

界面采用 **模态弹窗 (Modal)** 或 **侧边栏 (Sidebar)** 形式，覆盖在视频播放器之上。

#### 2.1 顶部：全局搜索栏

- 
- **功能**：实时过滤标签库。
- **交互**：支持输入关键词（匹配 texts 和 groupName）。
- **快捷操作**：如果搜索结果为空，按 Enter 键直接以此关键词触发“标签创建”对话框。

#### 2.2 主体：分组标签展示区

这是核心操作区域，展示从 tags.json 读取的所有标签。

- 
- **布局方式**：按 **分组 (Group)** 进行区块划分。
  - 
  - *Group Header*：显示分组名称（如“风景”、“人物”）。
  - *Group Body*：网格排列该分组下的所有标签。
- **排序**：
  - 
  - **已选中优先**：当前视频已分配的标签，建议置顶显示或在各分组内前置。
  - **相关性排序**：在搜索模式下，匹配度高的分组/标签排在前面。

#### 2.3 底部/角落：操作栏

- 
- **新建按钮**：显式的“新建标签”入口。
- **确认/关闭**：保存当前分配状态并返回播放。

------



### 3. 视觉表现 (Visual Representation)

基于统一数据结构，根据 imagePath 是否为空，渲染两种不同的单元格（Card/Chip）：

#### A. 文本标签 (Text Tag)

- 
- **外观**：胶囊型 (Chip) 或小卡片。
- **内容**：仅显示主关键词 (texts[0])。
- **样式**：简约文本，占用空间小。

#### B. 图片标签 (Image Tag)

- 
- **外观**：矩形卡片 (Card)。
- **内容**：
  - 
  - **缩略图**：加载 imagePath 指向的截图。
  - **文字覆盖**：在底部或悬浮层显示主关键词 (texts[0])。
- **优势**：利用视觉记忆快速定位（例如看到“夕阳图”直接点击，而不用看文字）。

#### C. 状态标识 (State Indication)

区分标签是否已分配给当前视频：

- 
- **未选中 (Default)**：半透明、灰度或低饱和度。
- **已选中 (Active)**：
  - 
  - **高亮边框** (High-contrast border)。
  - **打钩图标** (Checkmark badge)。
  - **全彩显示** (针对图片标签)。

------



### 4. 交互逻辑 (Interaction Logic)

#### 4.1 搜索与过滤

- 
- **实时性**：输入即响应。
- **逻辑**：
  - 
  - 输入 "海" -> 界面仅保留显示含有“海”字的分组和标签。
  - 分组内若无匹配项，隐藏该分组标题。

#### 4.2 选取与取消 (Toggle)

- 
- **单击**：在“已分配”与“未分配”状态间切换。
  - 
  - *Assign*：将标签 ID 写入当前视频的元数据。
  - *Unassign*：从当前视频元数据中移除标签 ID。
- **批量操作**：用户可以连续点击多个标签，无需每次点击都关闭窗口。

#### 4.3 找不到就创建 (Search to Create)

这是连接“分配”与“创建”的关键桥梁。

- 
- **场景**：用户搜索 "UFO"，结果显示“无匹配标签”。
- **操作**：
  - 
  - 界面显示提示：“未找到 'UFO'，按 Enter 创建新标签”。
  - 用户按 Enter。
  - **跳转**：关闭分配页面，打开 **标签创建页面**。
  - **数据传递**：将 "UFO" 自动填入创建页面的“描述输入框”中，且作为文本标签的默认值（如果用户此时框选了区域，则转为图片标签创建）。

------



### 5. 数据处理

- 
- **读取**：
  - 
  - tags.json：获取所有可用标签。
  - files.json (或当前视频对象)：获取 assigned_tag_ids 列表，用于渲染选中状态。
- **写入**：
  - 
  - 仅更新 files.json 中当前视频的 assigned_tag_ids。
  - **不修改** tags.json（除非触发了新建流程）。

### 6. 总结流程图

codeMermaid



```
graph TD
    A[打开分配页面] --> B[加载 tags.json & 视频状态]
    B --> C[渲染分组列表]
    C --> D{用户行为}
    
    D -- 输入关键词搜索 --> E[过滤显示列表]
    E -- 有结果 --> F[点击标签 Toggle 选中状态]
    E -- 无结果 --> G[按 Enter 跳转创建页面]
    
    D -- 直接浏览 --> F
    
    F --> H[更新当前视频元数据]
    G --> I[进入标签创建流程]
```