### 1. 痛点与动机

- **痛点**：
  - 视频截图通常需要作为素材导出，但源视频方向（如竖屏视频在横屏显示器）可能导致截图方向歪倒，后期处理繁琐。
  - 刚打开视频时“截图轨道”空空如也，用户无法快速预览视频概貌。
  - 误删操作容易导致包含重要截图的视频片段被遗弃。
- **动机**：
  - 提供**纯净的源分辨率截图**，并在导出环节提供**独立的旋转控制**（预览+批处理）。
  - 通过**自动生成关键帧**（9等分）填充轨道，提升内容预览效率。
  - 在裁剪编辑时提供**视觉警示**，防止误删已标记重点（已截图）的片段。

### 2. 功能概要

- **源画质截图**：截取视频原始分辨率、原始方向的图像，保存至数据目录。
- **自动补全**：视频首次加载若无截图，自动生成 9 张等间隔截图。
- **智能导出**：将当前视频的所有截图导出到指定目录。首次导出或强制设置时，提供旋转预览与配置（0°, 90°, 180°, 270°）。
- **交互反馈**：截图与导出操作均有半透明 Toast 提示；裁剪模式下提供误删警示。

### 3. Setting 配置与数据存储

- **配置文件** ()：
  - setting.json  / screenshot_export_path: 截图导出的目标根目录。
  - files.json / metadata：需记录 screenshot_rotation 字段。
- **存储逻辑**：
  - **源文件存储**：Data/screenshot/[Video_Hash]/。
  - **文件名命名**：i_[毫秒时间戳].webp。
  - **旋转参数记录**：
    - null / 不存在：未设置（触发弹窗）。
    - 0, 90, 180, 270：用户设定的旋转角度。

### 4. 快捷键

- **执行截图**：e
  - 截取当前帧，无阻断，仅 Toast 提示。
- **导出/配置截图**：Alt + e
  - 强制调出“截图导出配置”弹窗，重新设定旋转角度并导出。

### 5. 交互逻辑

| 场景         | 用户/系统操作    | 内部逻辑                                                     | UI 变化                                                      | 数据变化                         |
| ------------ | ---------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------------------------- |
| **视频加载** | 打开视频         | 1. 检查 Data/screenshot/[Hash] 下是否有图片。<br>2. **若无图片**：自动计算 9 个等分时间点，后台截取源分辨率图像。 | 截图轨道加载并显示截图（含自动生成的）。                     | 磁盘生成 9 张 webp 文件。        |
| **手动截图** | 按下 e           | 1. 截取当前源视频帧（不带旋转处理）。<br>2. 保存至数据目录。 | 1. 视口中上部显示半透明 Toast：“截图已保存”。<br>2. 截图轨道实时新增一张图。 | 磁盘新增图片文件。               |
| **导出截图** | 按下 Ctrl + e    | 1. 读取元数据 screenshot_rotation。<br>2. **若已有值**：直接按该角度旋转并复制文件到导出目录。<br>3. **若无值**：触发“导出配置弹窗”。 | 1. 若直接导出：显示 Toast “导出成功”。<br>2. 若未配置：弹出配置模态框。 | 目标路径下生成文件夹及图片。     |
| **强制配置** | 按下 Alt + e     | 1. 忽略已有配置，强制打开“导出配置弹窗”。                    | 弹出配置模态框。                                             | 无直接数据变化，等待确认。       |
| **确认导出** | 在弹窗点击“确认” | 1. 记录当前选择的角度到元数据。<br>2. 执行旋转处理并导出。   | 1. 关闭弹窗。<br>2. 显示 Toast “导出成功”。                  | 更新元数据 screenshot_rotation。 |

### 6. UI 说明

#### 6.1 主界面调整

- **Toast 提示**：
  - **样式**：半透明黑色背景，白色文字，圆角。
  - **位置**：视口（Video Viewport）水平居中，垂直靠上（约 Top 20% 位置）。
  - **交互**：显示 0.5 秒后自动淡出，不阻挡鼠标点击。

#### 6.2 截图导出配置弹窗

- **触发时机**：
  - 用户点击导出且元数据中无旋转记录时。
  - 用户按下 Alt + e 时。
- **布局**：
  - **顶部**：四个选项按钮/单选框 0°, 90°, 180°, 270°。
    - 若首次打开，默认选中 0°。
    - 若强制打开，默认选中当前记录的值。
  - **中部**：**预览滚动区**。
    - 显示当前视频所有截图的缩略图。
    - 实时根据顶部选项的选择进行旋转渲染（即：用户选 90°，预览区的图就顺时针转 90°）。
    - 目的：让用户直观确认导出的图片方向是否正确。
  - **底部**：确认导出 按钮。

### 7. 数据处理细节

- **截图与视频旋转的关系**：
  - **存储层**：Data 目录下的 i_xxx.webp 永远保持视频文件的**原始扫描线方向**（即 Raw Data），不应用任何旋转元数据。
  - **导出层**：需读取**截图导出**的旋转设置（screenshot_rotation）来处理最终输出的图片文件。
- **自动生成逻辑**：
  - 生成的 9 张图也保存在 Data/screenshot/[Hash]/ 下。
  - 与用户手动截图享有同等地位（可被设为封面、可被导出、受删除逻辑影响）。
- **文件冲突**：
  - 导出时，如果目标文件夹已存在同名文件，**直接覆盖**（Rewrite），不弹窗询问。