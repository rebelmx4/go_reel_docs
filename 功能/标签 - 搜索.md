### 1. 痛点与动机

- 
- **痛点**：
  - 
  - **文件名局限**：文件名无法包含所有细节（如“海边的日落”可能只被命名为 IMG_001.mp4）。
  - **维度单一**：文件夹分类互斥，一个视频只能在一个文件夹，无法同时属于“风景”和“人像”。
  - **检索困难**：用户记得画面内容（如“那个有红色跑车的视频”），但无法通过文字搜索找到。
- **动机**：
  - 
  - 利用**语义化元数据**实现精准检索。
  - 提供**“视觉索引”**：让用户通过点击熟悉的图片标签（截图）来查找视频，比回忆文字更直观。
  - 支持**多条件筛选**（交集逻辑），快速缩小查找范围。

### 2. 功能概要

- 
- **基于标签筛选**：从已有的标签库中选择一个或多个标签，过滤出包含这些标签的视频。
- **可视化筛选器**：复用“标签分配页面”的 UI 逻辑，按分组展示所有标签，支持图片标签的缩略图展示。
- **动态列表**：筛选结果实时更新，并构成一个临时的播放列表。

### 3. UI 布局与交互

#### 3.1 入口位置

- 
- **页签按钮**：位于 **精品列表按钮** 的后面，**文件名搜索按钮** 的前面（属于核心检索功能区）。

#### 3.2 界面结构

界面分为左右（或上下）两部分：**筛选控制区** 和 **结果展示区**。

**A. 筛选控制区 (Tag Picker)**
类似于“标签分配”页面的只读版本，作为筛选器使用。

- 
- **搜索框**：用于快速查找特定标签。
- **分组展示**：按 groupName 归类展示所有标签。
- **标签单元**：
  - 
  - **文本标签**：显示文字胶囊。
  - **图片标签**：显示截图卡片（直观的视觉索引）。
- **状态**：
  - 
  - **未选中**：默认样式。
  - **已选中**：高亮/打钩状态，表示当前筛选条件包含此标签。

**B. 结果展示区 (Results Grid)**

- 
- **布局**：标准的 Grid 网格视图（同最新/精品列表）。
- **内容**：显示符合筛选条件的视频缩略图、文件名、时长。
- **空状态**：若组合条件无匹配视频，显示提示“未找到符合条件的视频”。

### 4. 筛选逻辑 (Core Logic)

#### 4.1 多标签逻辑：交集 (AND)

默认采用**交集**逻辑，以实现“精准定位”。

- 
- **场景**：用户先点击了“风景”标签，又点击了“雪山”标签。
- **结果**：只显示**同时拥有**“风景”**和**“雪山”这两个标签的视频。
- *逻辑公式*：Result = Set(Tag_A) ∩ Set(Tag_B)。
- *理由*：随着标签增多，用户通常希望缩小范围找到特定视频，而不是扩大范围。

#### 4.2 实时响应

- 
- 每点击（选中/取消选中）一个标签，右侧结果区域立即重新计算并刷新。

### 5. 播放列表联动

- 
- **上下文切换**：
  - 
  - 当用户在筛选结果中双击一个视频时：
    1. 
    2. 播放器加载该视频。
    3. 内部播放列表状态切换为 **“标签搜索列表”**。
- **自动连播**：
  - 
  - 当前视频播放结束后，自动播放筛选结果中的下一个视频。
  - *场景*：用户筛选“健身教程”标签，然后可以放下鼠标，连续看完所有相关视频。

### 6. 数据处理

- 
- **数据源**：
  - 
  - 读取 tags.json 构建筛选器 UI。
  - 读取 files.json 中的 assigned_tag_ids 字段进行匹配计算。
- **性能优化**：
  - 
  - 由于是内存计算（In-Memory），即使有几千个视频，交集运算也极快。
  - 建议建立倒排索引（Inverted Index）：Map<TagID, List<VideoHash>>，避免每次筛选都遍历所有视频。

### 7. 总结：三种搜索/列表方式对比













| 特性         | 标签搜索 (Tag Search)      | 文件名搜索 (Filename Search) | 自动列表 (Random/Newest...) |
| ------------ | -------------------------- | ---------------------------- | --------------------------- |
| **检索依据** | **内容/语义** (用户标注)   | **元信息** (文件名)          | **属性** (时间/随机)        |
| **筛选方式** | 点击标签 (可视化)          | 输入文字 (模糊匹配)          | 自动聚合                    |
| **主要优势** | **精准、跨文件夹、视觉化** | 查特定番号/集数              | 浏览、探索                  |
| **结果逻辑** | 交集 (AND)                 | 模糊包含 (Like)              | 排序 (Order By)             |