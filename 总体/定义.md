#### 视频伴生数据定义

是指 `files.json`中的元数据条目、封面图片、截图文件 三类实体的总称



#### 视频文件和**视频伴生数据**的关系

视频文件、`files.json`中的元数据条目、封面图片、截图文件是四个独立的实体。它们通过**视频文件的哈希值**这一唯一标识符进行松散耦合，而非强绑定关系。

元数据根本不会记录有没有截图，封面及他们的位置的信息。软件通过约定路径去查找。

```
视频文件 (通过内容计算哈希值)
    ↓
哈希值: a1b2c3d4... (作为关联枢纽)
    ├───→ files.json 中的元数据条目 (key = 哈希值)
    ├───→ 封面文件 (data/covers/hash.webp)
    └───→ 截图文件 (存储在以哈希值命名的文件夹中)
```





#### 会触发files新增条目的操作

1. **点赞 (Liking)**
   - 用户首次点击心形图标，即使只是点赞1次。
   
2. **分配标签 (Assigning a Tag)**
   - 成功为视频分配了至少一个标签。
   
3. **旋转视频 (Rotating Video)**
   
   - 用户点击旋转按钮，改变了视频的默认旋转角度（即非0度）。
   
4. **设置截图旋转角度 (Setting Screenshot Rotation)**
   - 用户改变了默认的截图旋转角度（即非0度）。
   
5. **收藏 (Adding to Favorites)**
   - 用户将视频标记为收藏。
   
     

不会触发行为files新增条目的操作

1. **手动截图 **
1. **播放视频**
   - 说明**： 单纯观看视频，无论时长多长、播放多少次。**不记录** `last_played`（最后播放时间）和 `play_count`（播放次数）。
1. **设置封面**
   - 例如，

1. **收藏**




#### 会触发文件需要封面的操作

“需要封面”是指视频会出现在一个**列表式界面**中，为了更好的视觉效果，系统需要一张图作为代表。这**不会自动设置封面**，而是按以下逻辑显示：

1. **视频进入“最近播放列表”****触发操作**： 视频被播放过（但此行为本身不记录）。**封面逻辑**： 如果该视频已有元数据条目且设置了 `thumbnail`路径，则显示该封面；否则可能显示默认图标或视频首帧。

2. **视频进入“收藏列表”****触发操作**： 用户收藏了视频（此操作会创建元数据条目）。**封面逻辑**： 显示已设置的封面或默认图。

3. **视频出现在“点赞统计页面”****触发操作**： 视频被点赞过（此操作会创建元数据条目）。**封面逻辑**： 显示已设置的封面或默认图。

4. **视频出现在“标签搜索结果”中****触发操作**： 视频因标签搜索匹配而被列出。**封面逻辑**： 显示已设置的封面或默认图。

   

#### 封面产生的两种方式

封面产生分为自动临时封面和用户永久封面，具体逻辑如下：

1. **自动生成临时封面（用于列表显示）**
   - 触发条件：当视频首次需要出现在列表界面时（如最近播放列表、收藏列表、点赞统计页面），但用户从未主动设置过封面。
   - 生成规则：系统自动从视频长度的20%位置提取一帧作为临时封面图。保存到磁盘data/covers/hash.webp，仅用于当前界面显示
2. **用户主动设置封面**
   - 触发条件：用户对通过快捷键当前视频帧设置为封面。
   - 保存机制：系统会将封面图片保存到data/covers/hash.webp
3. **用户使用截图作为封面**
   - 触发条件：用户对选中的截图使用指定的快捷键将当前选中的截图设置为封面。
   - 保存机制：系统会复制截图保存到data/covers/hash.webp，这种方式产生的封面和截图就是独立的，之后互不影响



#### 截图

截图功能（按E键保存截图）是一个相对独立的功能模块

- **独立存储**：截图文件直接保存到以视频文件哈希值命名的文件夹下（如`data/files/<视频哈希>/screenshots/`），与`files.json`元数据条目无关。截图操作本身不会触发元数据条目的创建或更新。
- **功能隔离**：截图主要用于内容浏览和标记（如截图轨道上的导航），除非用户主动将截图设置为封面，否则截图数据不会影响元数据系统。
- **封面设置的唯一关联点**：只有当用户**手动将一张截图设置为封面**时，截图功能才会与元数据系统产生交互：该截图的路径会被记录到`files.json`对应视频的`thumbnail`字段中，从而成为永久封面。



#### 收藏

仅在favorite.json新增文件hash的记录